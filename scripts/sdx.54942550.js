!function(){"use strict";function a(){return function(a){return a?a.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}angular.module("sdx.utils",[]).filter("capitalize",a)}(),function(){"use strict";angular.module("sdx.constants",["sdx.envConfig"]).constant("toastrNoDismiss",{autoDismiss:!1,closeButton:!1,progressBar:!1,timeOut:0}).factory("API",["API_URL",function(a){return{BASE:a,ARSENAL:{BASE:a+"/api/mantenedores/MNT0003",COUNT:a+"/api/mantenedores/MNT0004"},ARTI:{BASE:a+"/api/mantenedores/ARTI_ARTICULO"},AUTH:{LOGIN:a+"/token",TICKET:function(b,c){return a+"/ticket/"+b+"/"+c},ISVALID:a+"/verifyToken",GET_USER_INFO:a+"/api/Account/UserInfo"},NOD:{BASE:a+"/api/mantenedores/NOD_NODO"},CTDA:{BASE:a+"/api/mantenedores/CTDA_CLASIFIACION_TIPO_ATENCION"},CITA:{BASE:a+"/api/mantenedores/CIT_CITA"},FNP:{BASE:a+"/api/mantenedores/FNP_FUNCIONARIO_PRESTADOR"},MPY:{BASE:a+"/api/mantenedores/MPY_MAESTRO_PARAMETROS_RAYEN"},PRA:{BASE:a+"/api/mantenedores/PRA_PARAMETROS_RAYEN"},GUID:{BASE:a+"/api/account/user"},TREC:{BASE:a+"/api/mantenedores/TREC_TIPO_RECETA",GET_RL_TREC_NOD:a+"/api/mantenedores/TREC_TIPO_RECETA?$expand=RL_TREC_NOD",RL_TREC_NOD:a+"/api/mantenedores/RL_TREC_NOD"},TDA:{BASE:a+"/api/mantenedores/TDA_TIPO_DE_ATENCION",TDAG:a+"/api/mantenedores/TDAG_TIPO_ATENCION_GENERICO",RL_TDAG_TDA:a+"/api/mantenedores/RL_ATDAG_TDA"},UNI:{BASE:a+"/api/mantenedores/UNID_UNIDAD"},LINE:{BASE:a+"/api/mantenedores/LINE_LINEA"},MSA:{BASE:a+"/api/mantenedores/MSA_SOLICITUD_ARTICULO"},MES:{BASE:a+"/api/mantenedores/MES_ESTADO_SOLICITUD_ARTICULO"},MHS:{BASE:a+"/api/mantenedores/MHS_HISTORIAL_SOLICITUD"},USER:{BASE:a+"/api/Account/userinfo"},ACCOUNT:{BASE:a+"/api/Account/USER",COUNT:"",PUT:a+"/api/Account/USER",ROLES:a+"/api/Account/USERROLE"},ROLES:{BASE:a+"/api/Account/ROLES",PERMISSIONS:a+"/api/Account/ROLESPERMISSIONS",EMPTY:a+"/api/Account/ROLES/ISEMPTY"},RECETA:{BASE:a+"/api/mantenedores/MNT0012",COUNT:a+"/api/mantenedores/MNT0013"},PRES:{BASE:a+"/api/mantenedores/PRES_PRESCRIPCION"},SGH:{BASE:a+"/api/mantenedores/SGH_SEGMENTOS_HORARIOS"},BODE:{BASE:a+"/api/mantenedores/BODE_BODEGA"},RL_BODEARTI:{BASE:a+"/api/mantenedores/RL_BODE_ARTI"}}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){b.defaults.headers.common.Authorization=function(){return c.getCurrentStaffMemberAuthorization()},a.$emit("rootScope:restoreState"),g.onbeforeunload=function(){a.$emit("rootScope:saveState")};var i;a.$on("$stateChangeStart",function(b,g,h,i,j){g.data&&g.data.permisoEntrada&&(e.clear(),b.preventDefault(),c.CurrentStaffMemberHasPermission(g.data.permisoEntrada)?d.go(g.name,h,{notify:!1}).then(function(){a.$broadcast("$stateChangeSuccess",g,h,i,j)}):(e.error("Usted no tiene acceso a módulo: "+g.data.titulo,"",f),c.isStaffMemberLogged()||c.goToLoginPage()))}),a.$on("$stateChangeError",function(a,b,c,d,g,i){e.clear(),h.error("event was:",a),h.error("error was:",i),e.error(angular.isString(i)?i:"Evento no esperado",b.data.titulo,f),a.preventDefault()}),a.$on("$stateChangeSuccess",function(){e.clear(i),$(document).scrollTop(0)})}angular.module("sdx.login",["sdx.constants","ngSanitize","ngAnimate","toastr","ui.router","sdx.utils"]).run(a),a.$inject=["$rootScope","$http","loginService","$state","toastr","toastrNoDismiss","$window","$log"]}(),function(){"use strict";angular.module("sdx.login").constant("PERMISSIONS",{MANTENEDOR:{CONSULTAR_ARTICULO:"CONSULTAR_ARTICULO",VER_DETALLE_ARTICULO:"VER_DETALLE_ARTICULO",CONSULTAR_SOLICITUD_ARTICULO:"CONSULTAR_SOLICITUD_ARTICULO",CREAR_SOLICITUD_ARTICULO:"CREAR_SOLICITUD_ARTICULO",PASIVAR_ARTICULO:"PASIVAR_ARTICULO",CREAR_ARTICULO:"CREAR_ARTICULO",APROBAR_SOLICITUD_FARMACO:"APROBAR_SOLICITUD_FARMACO",APROBAR_SOLICITUD_INSUMO:"APROBAR_SOLICITUD_INSUMO",LISTAR_RECETA:"LISTAR_RECETA",MODIFICAR_RECETA:"MODIFICAR_RECETA",ELIMINAR_RECETA:"ELIMINAR_RECETA",AGREGAR_RECETA:"AGREGAR_RECETA",LISTAR_PERFIL:"LISTAR_PERFIL",MODIFICAR_PERFIL:"MODIFICAR_PERFIL",DESACTIVAR_PERFIL:"DESACTIVAR_PERFIL",CREAR_PERFIL:"CREAR_PERFIL",LISTAR_USUARIO:"LISTAR_USUARIO",MODIFICAR_USUARIO:"MODIFICAR_USUARIO",DESACTIVAR_USUARIO:"DESACTIVAR_USUARIO",CREAR_USUARIO:"CREAR_USUARIO",LISTAR_PARAMETRO:"LISTAR_PARAMETRO",MODIFICAR_PARAMETRO:"MODIFICAR_PARAMETRO",DESACTIVAR_PARAMETRO:"DESACTIVAR_PARAMETRO",LISTAR_TIPOS_CONSULTA:"LISTAR_TIPOS_CONSULTA",MODIFICAR_TIPO_CONSULTA:"MODIFICAR_TIPO_CONSULTA",ELIMINAR_TIPO_CONSULTA:"ELIMINAR_TIPO_CONSULTA",AGREGAR_TIPO_CONSULTA:"AGREGAR_TIPO_CONSULTA"}})}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=this;h.eliminarPermisosDuplicados=function(a){for(var b=[],c=0;c<a.length;c++){var d=b.filter(function(b){return b==a[c]});0==d.length&&b.push(a[c])}return b},h.toConsumableArray=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},h.staff={},h.currentStaffMemberId=null,h.facilities=[],h.currentFacility={Id:null,Name:null},h.tiposGlobales={perfiles:[]},h.resetCurrentFacility=function(){h.currentFacility&&(h.staff.hasOwnProperty(h.currentFacility.Id)&&delete h.staff[h.currentFacility.Id],h.tokens.hasOwnProperty(h.currentFacility.Id)&&delete h.tokens[h.currentFacility.Id]),h.currentFacility={Id:null,Name:null}},h.token=void 0,h.setToken=function(a){h.token=a},h.updateProfile=function(a,b){h.staff.Profile=b,h.staff.Profile.fullname=g("capitalize")(b.Name+" "+b.FathersFamilyName+" "+b.MothersFamilyName)},h.addStaffMember=function(a,b,c,d,e){return angular.isUndefined(d)&&(d=!1),a.Password=void 0,h.updateProfile(c),h.setToken(b),h.staff};var i={};return i.getCurrentStaffMember=function(){return h.staff?h.staff:null},i.getCurrentStaffMemberAuthorization=function(){return h.token?"Bearer "+h.token:void 0},i.CurrentStaffMemberIsActive=function(){return h.staff&&!h.staff.Locked?!0:!1},i.CurrentStaffMemberHasPermission=function(a){return h.staff&&h.staff.Profile&&h.staff.Profile.Permisos&&-1!=h.staff.Profile.Permisos.indexOf(a)?!0:!1},i.memberHasPermission=function(a){return i.getCurrentStaffMember()?i.CurrentStaffMemberHasPermission(a):!1},i.memberIsType=function(a){var b=i.getCurrentStaffMember();return b?a?i.getCurrentStaffMember().HealthPractitionerType.Id===a:!!i.getCurrentStaffMember().HealthPractitionerType.Id:void 0},i.isStaffMemberLogged=function(){return h.staff&&h.staff.Profile?!0:!1},i.logout=function(){return h.staff?(delete h.staff,h.token&&delete h.token,!0):!1},i.login=function(a,c){"admin"!=a.toLowerCase()&&(a=a.toUpperCase());var f="username="+a+"&password="+c+"&grant_type=password";return b({url:e.AUTH.LOGIN,method:"POST",data:f,headers:{Authorization:"Basic VEVTVDpURVNU",Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a&&a.data&&a.data.access_token?(h.setToken(a.data.access_token),b.get(e.ROLES.BASE).then(function(a){return h.tiposGlobales.perfiles=a.data,b.get(e.ROLES.PERMISSIONS).then(function(a){for(var b=0;b<h.tiposGlobales.perfiles.length;b++){var c=a.data.filter(function(a){return a.ID==h.tiposGlobales.perfiles[b].Id});c.length>0?h.tiposGlobales.perfiles[b].permisos=c:h.tiposGlobales.perfiles[b].permisos=[]}return i.getUserInfo().then(function(a){null==a.data.Permisos||""==a.data.Permisos?a.data.Permisos=[]:a.data.Permisos=a.data.Permisos.split(","),null==a.data.Restricciones||""==a.data.Restricciones?a.data.Restricciones=[]:a.data.Restricciones=a.data.Restricciones.split(",");for(var b=0;b<a.data.Roles.length;b++)for(var c=0;c<h.tiposGlobales.perfiles.length;c++)if(h.tiposGlobales.perfiles[c].Name==a.data.Roles[b]){for(var d=[],e=0;e<h.tiposGlobales.perfiles[c].permisos.length;e++)d.push(h.tiposGlobales.perfiles[c].permisos[e].PERMISO);a.data.Permisos=[].concat(h.toConsumableArray(a.data.Permisos),h.toConsumableArray(d))}a.data.Permisos=h.eliminarPermisosDuplicados(a.data.Permisos);for(var b=0;b<a.data.Restricciones.length;b++){var c=a.data.Permisos.indexOf(a.data.Restricciones[b]);c>-1&&a.data.Permisos.splice(c,1)}return h.staff={Profile:a.data},h.staff.Profile})})})):d.reject({Message:"Respuesta vacía"})})},i.getUserInfo=function(){var a=e.AUTH.GET_USER_INFO;return b.get(a)},i.checkIn=function(a,c,f){return a&&c&&f?b.get(e.AUTH.TICKET(c,a.Username),{params:{password:a.Password,getProfile:!0,idPT:f.Id}}).then(function(b){if(!b.data)return d.reject({Message:"Respuesta vacía"});if(!b.data.Profile.Permissions||!b.data.Profile.Permissions.length)return d.reject({Message:"No tiene permisos para urgencia web."});var e=b.data.Profile.StaffMember.IdHealthCareCenter.toString();return h.facilities[e]=c,h.setCurrentFacility(e),h.addStaffMember(a,b.data.EncodedToken,b.data.Profile,e,f,!0,b.data.Guid)}):d.reject({Message:"Error en parametros"})},i.facilityChange=function(){return h.oldFacilityId!==h.currentFacility.Id},i.checkToken=function(a,b){return h.tokens[a.IdFacility][a.Id]?d.resolve(!0):i.revalidateToken(a,b)},i.validToken=function(a,c){return h.tokens.hasOwnProperty(c)&&h.tokens[c].hasOwnProperty(a)?b.post(e.AUTH.ISVALID,{token:h.tokens[c][a]}).then(function(){return!0},function(){return!1}):!1},i.revalidateToken=function(a,c){return b.get(e.AUTH.TICKET(h.facilities[a.IdFacility],a.Login.Username),{params:{password:c,getProfile:!0}}).then(function(b){return b.data.hasOwnProperty("EncodedToken")&&i.isStaffMemberLogged()?b.data.Profile.Permissions&&b.data.Profile.Permissions.length?(h.setToken(a.Id,b.data.EncodedToken),h.updateProfile(a.Id,b.data.Profile,a.IdFacility),!0):d.reject({Message:"No tiene permisos para urgencia web."}):d.reject({Message:"respuesta vacía"})})},i.resetToken=function(){delete h.tokens},i.goToLoginPage=function(){return c.location.href="http://"+c.location.host+f,!1},i.lock=function(){h.currentStaffMemberId=null},h.SaveState=function(){localStorage.staff=angular.toJson(h.staff),localStorage.token=h.token},h.RestoreState=function(){localStorage.staff&&"undefined"!==localStorage.staff&&(h.staff=angular.fromJson(localStorage.staff)),localStorage.token&&(h.token=localStorage.token)},a.$on("rootScope:saveState",h.SaveState),a.$on("rootScope:restoreState",h.RestoreState),i}angular.module("sdx.login").factory("loginService",a),a.$inject=["$rootScope","$http","$window","$q","API","APP_LOGIN","$filter"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){a.facilityChange()?b.location.reload():(i.currentUser=a.getCurrentStaffMember(),i.staff=a.getStaff(),d.transitionTo(e.getValidState(),{},{reload:!0,inherit:!1,notify:!0}),f.success("Bienvenido "+i.currentUser.Profile.Name,"Cambio de sesión"))}var i=this;return i.currentUser=a.getCurrentStaffMember(),i.logout=function(b){"undefined"==typeof b&&(b=i.currentUser.Id),a.logout(b),i.currentUser=a.getCurrentStaffMember(),window.location.href=g},i.sessionsModal=function(b){if(a.lock(),b&&a.unlockStaff(b.Id,b.IdFacility))return void h();var d=c.open({backdrop:"static",templateUrl:"../common/login/modals/modal.sessions.html",controller:"SessionsModalController",controllerAs:"smc",windowClass:"rayen rayen-tall",keyboard:!1,resolve:{changeTo:function(){return b}}});d.result.then(h)},i}angular.module("sdx.login").controller("SdxAuthenticatedUsersController",a),a.$inject=["loginService","$window","$modal","$state","stateService","toastr","APP_LOGIN"]}(),function(){"use strict";angular.module("sdx.login").directive("sdxAuthenticatedUsers",function(){return{restrict:"E",templateUrl:"../common/login/directive/sdx.authenticatedUsers.directive.html",controller:"SdxAuthenticatedUsersController as auc"}})}(),function(){"use strict";function a(a,c,d){var e=this;return e.loginState="authentication",e.tryLogin=function(c){e.loginState="authentication",e.toLogin=b(c),e.toLogin.relogin=!0,e.isLoading=!0,a.lock(),e.isLoading=!1,$("#password").focus()},e.access=function(){e.error=null,e.isLoading=!0,a.login(e.toLogin.Login.Username,e.toLogin.Login.Password).then(function(b){return e.toLogin.relogin&&a.validToken(e.toLogin.Id,e.toLogin.IdFacility)&&a.unlockStaff(e.toLogin.Id,e.toLogin.IdFacility,e.toLogin.Login.rememberMe,!0)?c.close(e.toLogin):(e.toLogin.relogin=!1,e.toLogin.HealthPractitioners=b,c.close(e.toLogin))},function(a){null!=a.error_description&&(a.Message=a.error_description),e.error=a.Message||"Problema no especificado"})["finally"](function(){e.isLoading=!1})},e.checkIn=function(b,d){if(e.isLoading=!0,b=parseInt(b),d="undefined"==typeof d?0:parseInt(d),""===d&&e.toLogin.HealthPractitioners[b].HealthPractitionerTypes)return e.loginState="authentication",e.error="Ingrese un instrumento válido",e.isLoading=!1,!1;var f=e.toLogin.HealthPractitioners[b].HealthCareCenter,g={Name:e.toLogin.HealthPractitioners[b].HealthPractitionerTypes[d].Name,Id:e.toLogin.HealthPractitioners[b].HealthPractitionerTypes[d].Id},h=e.toLogin.Login.Password;return a.checkIn(e.toLogin.Login,f,g).then(function(b){a.checkToken(b,h).then(function(a){return a?c.close(e.toLogin):(e.loginState="noAccess",void(e.isLoading=!1))})},function(a){e.isLoading=!1,e.loginState="authentication",e.error=a.Message}),!1},e.resetLogin=function(){e.loginState="authentication",e.toLogin=b()},e.toLogin=b(d),d&&(e.toLogin.relogin=!0,$("#password").focus()),e.facilityName=function(b){return a.getFacilitiesNames()[b]},e}function b(a){return{Id:a?a.Id:null,IdFacility:a?a.IdFacility:null,Login:{Username:a?a.Login.Username:null,Password:null,rememberMe:a?a.Login.rememberMe:!1},HealthPractitioners:null}}angular.module("sdx.login").controller("SessionsModalController",a),a.$inject=["loginService","$modalInstance","changeTo"]}(),function(){"use strict";function a(a){a.interceptors.push(["$q","$injector",function(a,b){var c=b.get("InterceptorQueueService");return{request:function(a){return c.status()&&-1===a.url.indexOf("api/ticket")?c.putOnQueue(a):(-1===a.url.indexOf("api/")&&(a.headers.Authorization=null),a)},responseError:function(c){b.get("loginService");switch(c.status){case-1:return a.reject("Ha perdido la conexión de red");case 401:break;case 403:return a.reject({Message:"Ud. no tiene permisos"});default:return a.reject(c.data)}return a.reject(c)}}}])}angular.module("sdx.errors",["sdx.login"]).config(a),a.$inject=["$httpProvider"]}(),function(){"use strict";function a(a){var b=this;return b.queue=[],b.status=!1,{start:function(){b.status=!0},stop:function(){b.status=!1},status:function(){return b.status},putOnQueue:function(c,d){d="undefined"!=typeof d?d:!1;var e=a.defer();return b.queue.push({deferred:e,config:c,isRetry:d}),e.promise},processQueue:function(a,c){for(b.status=!1;b.queue.length;){var d=b.queue.shift();d.config.headers.Authorization=c.getCurrentStaffMemberAuthorization(),d.isRetry?a(d.config).then(d.deferred.resolve,d.deferred.reject):d.deferred.resolve(d.config)}},rejectQueue:function(a){for(b.status=!1;b.queue.length;){var c=b.queue.shift();c.deferred.reject(a)}}}}angular.module("sdx.errors").factory("InterceptorQueueService",a),a.$inject=["$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){b.defaults.headers.common.Authorization=function(){return i.getCurrentStaffMemberAuthorization()},a.$emit("rootScope:restoreState"),g.onbeforeunload=function(){a.$emit("rootScope:saveState")};var j;a.$on("$stateChangeStart",function(a,b,c,d,e){b.data&&b.data.permisoEntrada&&a.preventDefault()}),a.$on("$stateChangeError",function(a,b,c,d,g,i){e.clear(),h.error("event was:",a),h.error("error was:",i),e.error(angular.isString(i)?i:"Evento no esperado",b.data.titulo,f),a.preventDefault()}),a.$on("$stateChangeSuccess",function(){e.clear(j),$(document).scrollTop(0)})}angular.module("sdx.data",["sdx.constants","ngSanitize","toastr","ui.router","sdx.utils"]).run(a),a.$inject=["$rootScope","$http","dataService","$state","toastr","toastrNoDismiss","$window","$log","loginService"]}(),function(){"use strict";function a(a,b){var c={};return c.getACCOUNT=function(c,d,e,f,g,h){var i="&$top=10";""!=d&&(i="&$top="+d);var j="&$skip=0";""!=e&&e>1&&(j="&$skip="+(e-1)*d);var k="&$orderby=FullName ";""!=f&&(k="&$orderby="+f);var l="desc";""!=g&&(l=g),k=k+" "+l;var m="";null!=h&&(m=h);var n=" and Locked eq false";"todos"==c?n="":"inactivo"==c&&(n=" and (Locked eq true or Locked eq null) ");var o=b.ACCOUNT.BASE+"?select=*,Roles&$expand=Roles&$filter=substringof('"+m+"',FullName)"+n+i+j+k;return a.get(o)},c.countACCOUNT=function(c,d,e,f){var g="&$top=10";""!=d&&(g="&$top="+d);var h="&$skip=0";""!=e&&e>1&&(h="&$skip="+(e-1)*d);var i="";null!=f&&(i=f);var j=" and Locked eq false";"todos"==c?j="":"inactivo"==c&&(j=" and (Locked eq true or Locked eq null) ");var k=b.ACCOUNT.BASE+"?select=Id&$filter=substringof('"+i+"',FullName)"+j;return a.get(k)},c.getAccountRut=function(c){c=c.trim();var d=b.ACCOUNT.BASE+"?select=Id&$filter= Locked eq false and Rut eq '"+c+"'";return a.get(d)},c.getAccountCorreo=function(c){c=c.trim();var d=b.ACCOUNT.BASE+"?select=Id&$filter= Locked eq false and Email eq '"+c+"'";return a.get(d)},c.putUSER=function(c){var d=b.ACCOUNT.PUT;return a.put(d,c)},c.postUSER=function(c){var d={Rut:c.rut.toUpperCase(),FullName:c.nombre,Locked:!1,Nodos:c.nodos,Permisos:c.permisos,Restricciones:c.restricciones,Email:c.correo,EmailConfirmed:!0,Password:c.clave,SecurityStamp:c.stamp,PhoneNumber:null,PhoneNumberConfirmed:!1,TwoFactorEnabled:!1,LockoutEndDateUtc:null,LockoutEnabled:!1,AccessFailedCount:0,UserName:c.rut.toUpperCase()},e=b.ACCOUNT.BASE;return a.post(e,d)},c.putUserPassword=function(c,d){var e=b.ACCOUNT.PUT+"/"+c+"/password/"+encodeURIComponent(d);return a.put(e)},c.putUserPerfil=function(c,d,e){var f=b.ACCOUNT.ROLES+"/"+c+"/"+d;return a.put(f,{},{input:{position:e}})},c.deleteUserPerfil=function(c,d,e){var f=b.ACCOUNT.ROLES+"/"+c+"/"+d;return a["delete"](f,{input:{position:e}})},c.getListaROLES=function(){var c=b.ROLES.BASE;return a.get(c)},c.getROLES=function(c,d,e,f){var g="&$top=10";void 0!=c&&(g="&$top="+c);var h="&$skip=0";void 0!=d&&d>1&&(h="&$skip="+(d-1)*c);var i="&$orderby=Name ",j=i+"asc";void 0!=f&&""!=f&&(j=i+f);var k="";void 0!=e&&""!=e&&(k="$filter=substringof('"+e+"',Name) ");var l=b.ROLES.BASE+"?"+k+g+h+j;return a.get(l)},c.countROLES=function(c){var d="";void 0!=c&&""!=c&&(d="$filter=substringof('"+c+"',Name) ");var e=b.ROLES.BASE+"?"+d;return a.get(e)},c.isEmptyRole=function(c){var d=b.ROLES.EMPTY+"/"+c;return a.get(d)},c.deleteRole=function(c){var d=b.ROLES.BASE+"/"+c;return a["delete"](d)},c.postRole=function(c){var d={Name:c},e=b.ROLES.BASE;return a.post(e,d)},c.putRole=function(c){var d=b.ROLES.BASE;return a.put(d,c)},c.getRolesPermisos=function(c){var d="";null!=c&&""!=c&&(d="?$filter=Id eq "+c);var e=b.ROLES.PERMISSIONS+d;return a.get(e)},c.deleteRolesPermisos=function(c,d,e){var f=b.ROLES.PERMISSIONS+"/"+c+"/"+d;return a["delete"](f,{input:{position:e}})},c.putRolesPermisos=function(c,d,e){var f=b.ROLES.PERMISSIONS+"/"+c+"/"+d;return a.put(f,"",{input:{position:e}})},c.getUSER=function(c){var d=b.USER.BASE;return a.get(d)},c.getUserInfo=function(){var c=b.ACCOUNT.GET_USER_INFO;return a.get(c)},c.getListaUSER=function(){var c=b.ACCOUNT.BASE+"?$select=FullName, Id";return a.get(c)},c.getNOD=function(d){1==d.length&&""==d[0]&&(d=[]);var e=" ";if(void 0!=d&&d.length>0){var f=0;for(f=0;f<d.length;f++)e=0==f?"ID eq "+d[f]:e+" or ID eq "+d[f];e=" and ("+e+") "}var g=b.NOD.BASE+"?$select=ID,DOMINIO,RAZON_SOCIAL,DESCRIPCION,TIPO,COM_COMUNA/NOMBRE,NOD_ID&$expand=COM_COMUNA&$filter=ACTIVO eq 1 and ELIMINADO eq 0 "+e,h=a.get(g).then(function(a){return c.postProcesoNodo(a)});return h},c.getServiciosSalud=function(){var d=b.NOD.BASE+"?$select=ID,DOMINIO,DESCRIPCION,TIPO,RAZON_SOCIAL&$filter=ACTIVO eq 1 and ELIMINADO eq 0 and TIPO eq 3",e=a.get(d).then(function(a){return c.postProcesoNodo(a)});return e},c.getNodosServiciosSalud=function(d){var e=b.NOD.BASE+"?$select=ID,RAZON_SOCIAL,DOMINIO,DESCRIPCION,TIPO,NOD_ID,COM_COMUNA/ID,COM_COMUNA/NOMBRE&$filter=ACTIVO eq 1 and ELIMINADO eq 0 and NOD_ID eq "+d+"&$expand=COM_COMUNA",f=a.get(e,{input:{servicio:d}}).then(function(a){return c.postProcesoNodo(a)});return f},c.postProcesoNodo=function(a){var b=a.data.filter(function(a){return null!=a.DOMINIO&&null!=a.RAZON_SOCIAL&&a.DOMINIO.length>0&&!a.RAZON_SOCIAL.toUpperCase().includes("RAYEN")&&!a.RAZON_SOCIAL.toUpperCase().includes("SAYDEX")});return a.data=null!=b?b:[],a},c.getMPY=function(c,d,e){var f="&$top=10";void 0!=c&&(f="&top="+c);var g="&skip=0";void 0!=d&&d>1&&(g="&skip="+(d-1)*c);var h="";void 0!=e&&""!=e&&(h=" and substringof('"+e+"',DESCRIPCION) ");var i=b.MPY.BASE+"?$expand=MVP_PARAMETROS_VALORES_POSIBLES, MTP_TIPO_PARAMETRO&$filter=ACTIVO eq true and ELIMINADO eq false"+f+g+h;return a.get(i)},c.getCountMPY=function(c){var d="";void 0!=c&&""!=c&&(d=" and substringof('"+c+"',DESCRIPCION) ");var e=b.MPY.BASE+"?$select=NOMBRE&$filter=ACTIVO eq true and ELIMINADO eq false"+d;return a.get(e)},c.getAccountUsers=function(c){var d=b.GUID.BASE+"/"+c;return a.get(d)},c.getPRA=function(c){var d=0;void 0!=c&&c>0&&(d=c);var e=b.PRA.BASE+"?$filter= NOD_ID eq "+d;return a.get(e)},c.putPRA=function(d,e){if(null!=e&&e){var f=new Date,g=c.getFechaEntero(f);d.FECHA_ULTIMA_ACTUALIZACION=f,d.FECHA_ULTIMA_ACTUALIZACION_ENTERO=g}var h=b.PRA.BASE;return a.put(h,d)},c.postPRA=function(c){var d=b.PRA.BASE;return a.post(d,c)},c.getTRECPorID=function(c){var d=b.TREC.GET_RL_TREC_NOD+"&$filter=ID eq "+c;return a.get(d)},c.getTREC=function(c,d,e,f,g,h){var i=10;void 0!=d&&(i=d);var j=0;void 0!=e&&e>1&&(j=(e-1)*d);var k="";void 0!=f&&""!=f&&(k="substringof('"+f+"',DESCRIPCION) ");var l="ID";void 0!=g&&""!=g&&(l=g);var m="asc";void 0!=h&&""!=h&&(m=h);var n=b.TREC.BASE;return 0==c&&(n=b.TREC.GET_RL_TREC_NOD,n=""!=k?n+"&$filter="+k+"&$top="+i+"&$skip="+j+"&$orderby="+l+" "+m:n+"&$top="+i+"&$skip="+j+"&$orderby="+l+" "+m),a.get(n)},c.countTREC=function(c){if(void 0==c){var d=b.TREC.BASE;return a.get(d)}var d=b.TREC.GET_RL_TREC_NOD;return a.get(d)},c.putRL_TREC_NOD=function(c){var d=b.TREC.RL_TREC_NOD;return a.put(d,c)},c.deleteRL_TREC_NOD=function(c){var d=b.TREC.RL_TREC_NOD+"/"+c.TREC_ID+"/"+c.NOD_ID;return a["delete"](d)},c.postRL_TREC_NOD=function(c){var d=b.TREC.RL_TREC_NOD;return a.post(d,c)},c.getListaTREC=function(){var c=b.TREC.BASE+"?$filter=ELIMINADO eq 0&$orderby=DESCRIPCION asc";return a.get(c)},c.getNodoTREC=function(c,d,e,f){var g="&$top=10";""!=d&&(g="&$top="+d);var h="";""!=e&&e>1&&(h="&$skip="+(e-1)*d);var i=b.TREC.RL_TREC_NOD+"?$select=*&$filter=NOD_ID eq "+c+g+h;return a.get(i)},c.getCountTREC=function(c,d,e){var f=b.TREC.RL_TREC_NOD+"?$select=TREC_ID&$filter=NOD_ID eq "+c;return a.get(f)},c.getTDAByNombre=function(c,d){var e=b.TDA.BASE+"?$select=*&$filter=ACTIVO eq true and NOD_ID eq "+c+" and NOMBRE eq '"+d+"'";return a.get(e)},c.getTDA=function(c,d,e,f,g,h,i){var j=10;""!=d&&(j=d);var k=0;""!=e&&e>1&&(k=(e-1)*d);var l="NOMBRE";void 0!=f&&""!=f&&(l=f);var m="asc";void 0!=g&&""!=g&&(m=g);var n="";void 0!=h&&""!=h&&(n=" and substringof('"+h+"',NOMBRE) ");var o="NOD_ID eq null";void 0!=c&&c>0&&(o="NOD_ID eq "+c);var p=b.TDA.BASE+"?$select=*,ACT_ACTIVIDAD/NUM_REM,CTDA_CLASIFIACION_TIPO_ATENCION&$filter=ACTIVO eq true and "+o+n+"&$orderby="+l+" "+m+"&$top="+j+"&$skip="+k+"&$expand=ACT_ACTIVIDAD,CTDA_CLASIFIACION_TIPO_ATENCION";return a.get(p,{input:{position:i}})},c.getClasificacionTDA=function(c){var d=b.TDA.BASE+"?$select=ID,NOMBRE,CTDA_CLASIFIACION_TIPO_ATENCION&$filter= ID eq "+c+"&$expand=CTDA_CLASIFIACION_TIPO_ATENCION";return a.get(d,{input:{idTda:c}})},c.putTDA=function(c){var d=b.TDA.BASE;return delete c.ACT_ACTIVIDAD,delete c.CTDA_CLASIFIACION_TIPO_ATENCION,a.put(d,c)},c.postTDA=function(c){var d={ACT_ID:null,NOD_ID:c.nodId,NOMBRE:c.nombre,DURACION_SUGERIDA:c.duracion,CARDINALIDAD:c.cardinalidad,PROG_ID:null,ELIMINADO:0,ESESPONTANEO:c.espontaneo,morbilidad:c.morbilidad,ID_LOCAL:null,TID_LOCAL:null,ENVIAR_MENSAJERIA_CORTA:c.sms,CTDA_ID:c.clasificacion,ACTIVO:!0},e=b.TDA.BASE;return a.post(e,d)},c.deleteTDA=function(c){var d=b.TDA.BASE+"/"+c.ID;return a["delete"](d)},c.getCountTDA=function(c,d,e){var f=b.TDA.BASE+"?$select=NOMBRE&$filter=ACTIVO eq true and NOD_ID eq "+c;return a.get(f)},c.getCTDA=function(){var c=b.CTDA.BASE;return a.get(c)},c.getREM=function(){var c=b.TDA.TDAG;return a.get(c)},c.getTdaRem=function(c){var d="";if(void 0!=c&&c.length>0){for(var e=0;e<c.length;e++)d=0==e?"CTDA_ID eq "+c[e]:d+" or CTDA_ID eq "+c[e];d="&$filter=("+d+")"}var f=b.TDA.RL_TDAG_TDA+"?$select=*"+d;return a.get(f,{data:c.join(",")})},c.putTdaRem=function(c,d){var e={CTDA_ID:c.CTDA_ID,TDGA_ID:c.TDGA_ID,ELIMINADO:c.ELIMINADO},f=b.TDA.RL_TDAG_TDA;return a.put(f,e,{input:{position:d}})},c.postTdaRem=function(c,d){var e={CTDA_ID:c.CTDA_ID,TDGA_ID:c.TDGA_ID,ELIMINADO:c.ELIMINADO},f=b.TDA.RL_TDAG_TDA;return a.post(f,e,{input:{position:d}})},c.deleteTdaRem=function(c,d){var e=b.TDA.RL_TDAG_TDA+"/"+c+"/"+d;return a["delete"](e)},c.getArtiById=function(c){var d=b.ARTI.BASE+"/"+c;return a.get(d)},c.getARTI=function(c,d,e,f,g,h,i,j,k){var l=10;""!=c&&(l=c);var m=0;""!=d&&d>1&&(m=(d-1)*c);var n="NOMBRE_GENERICO";""!=e&&(n=e);var o="desc";""!=f&&(o=f);var p="";""!=i&&(void 0==k&&(k=!1),p=k?"and NOMBRE_GENERICO eq '"+i+"' ":"and substringof('"+i+"',NOMBRE_GENERICO) ");var q="and (ES_FARMACIA_POPULAR eq null or ES_FARMACIA_POPULAR eq 0)";h&&(q="and ES_FARMACIA_POPULAR eq 1");var r="and (LINE_ID eq 2 or LINE_ID eq 3)";"undefined"!=g&&"farmaco"==g&&(r="and LINE_ID eq 2 "),"undefined"!=g&&"insumo"==g&&(r="and LINE_ID eq 3");var s="ARTI_ID eq null and NOD_ID eq null";"undefined"!=j&&j>0&&(s="NOD_ID eq "+j);var t=b.ARTI.BASE+"?$select=*&$filter="+s+" "+r+" "+q+" "+p+"&$orderby="+n+" "+o+"&$top="+l+"&$skip="+m;return a.get(t)},c.countARTI=function(c,d,e,f){var g="";""!=e&&(g="and substringof('"+e+"',NOMBRE_GENERICO) ");var h="and (ES_FARMACIA_POPULAR eq null or ES_FARMACIA_POPULAR eq 0)",i="";d&&(h="and ES_FARMACIA_POPULAR eq 1",i="");var j="and ((LINE_ID eq 2 "+i+") or LINE_ID eq 3)";"undefined"!=c&&"farmaco"==c&&(j="and LINE_ID eq 2 "+i),"undefined"!=c&&"insumo"==c&&(j="and LINE_ID eq 3");var k="ARTI_ID eq null and NOD_ID eq null";"undefined"!=f&&f>0&&(k="NOD_ID eq "+f);var l=b.ARTI.BASE+"?$select=ID&$filter="+k+" "+j+" "+h+" "+g;return a.get(l)},c.postARTI=function(c){var d=".",e={UNID_ENT_ID:c.uAdministracion,UNID_MIN_ID:c.uEntrega,ARTI_ID:null,NOD_ID:null,LINE_ID:c.tipo,ACTIVO:1,CODIGO_INTERNO:null==c.codigoIsp||0==c.codigoIsp.trim().length?d:c.codigoIsp,CODIGO_ESTANDAR:null==c.codigoIsp||0==c.codigoIsp.trim().length?d:c.codigoIsp,NOMBRE_GENERICO:c.nombre,CENTINELA:c.esCentinela,PSICOTROPICO:c.esPsicotropico,AUGE:0,CONTROLADO:c.esControlado,STOCK_ACTUAL:0,MONITOREADO:c.esMonitoreado,STOCK_CRITICO:10,STOCK_MINIMO:10,FACTOR_CONVERSION_ENTREGA:c.factor,ULTIMO_PRECIO:0,ACCION_TERAPEUTICA:0,TIEMPO_REPOSICION:0,ELIMINADO:0,ID_LOCAL:0,APLICA_URGENCIA:0,ARTICULO_VALIDADO:c.esValidado,ES_FARMACIA_POPULAR:c.esFarmaciaPopular},f=b.ARTI.BASE;return a.post(f,e)},c.getUNI=function(){var c=b.UNI.BASE+"?$select=*";return a.get(c)},c.getLINE=function(){var c=b.LINE.BASE+"?$select=*";return a.get(c)},c.getMES=function(c,d,e,f,g,h,i){var j=b.MES.BASE+"?$select=*";return a.get(j)},c.getMSA=function(c,d,e,f,g,h,i,j,k){var l=10;""!=c&&(l=c);var m=0;""!=d&&d>1&&(m=(d-1)*c);var n="NOMBRE_GENERICO";""!=e&&(n=e);var o="desc";""!=f&&(o=f);var p="";""!=h&&(p="and (ES_FARMACIA_POPULAR eq null or ES_FARMACIA_POPULAR eq false)",h&&(p="and ES_FARMACIA_POPULAR eq true"));var q="and (LINE_ID eq 2 or LINE_ID eq 3)";"undefined"!=g&&"farmaco"==g&&(q="and LINE_ID eq 2 "),"undefined"!=g&&"insumo"==g&&(q="and LINE_ID eq 3");var r="";""!=i&&(r=" and substringof('"+i+"',NOMBRE_GENERICO) ");var s="";if(j.length>0){for(var t=0;t<j.length;t++)s=0==t?"MES_ID eq "+j[t]:s+" or MES_ID eq "+j[t];s=" and ("+s+")"}var u="";""!=k&&(u=" and ASPNET_USER_ID eq '"+k+"'");var v=b.MSA.BASE+"?$select=*,MHS_HISTORIAL_SOLICITUD&$filter=ACTIVO eq true "+p+" "+q+r+s+u+"&$expand=MHS_HISTORIAL_SOLICITUD&$orderby="+n+" "+o+"&$top="+l+"&$skip="+m;return a.get(v)},c.countMSA=function(c,d,e,f,g,h){var i="and (ES_FARMACIA_POPULAR eq null or ES_FARMACIA_POPULAR eq false)";d&&(i="and ES_FARMACIA_POPULAR eq true"),"todo"==d&&(i="");var j=" and (LINE_ID eq 2 or LINE_ID eq 3)";"undefined"!=c&&"farmaco"==c&&(j=" and LINE_ID eq 2 "),"undefined"!=c&&"insumo"==c&&(j=" and LINE_ID eq 3");var k="";""!=e&&(k=" and substringof('"+e+"',NOMBRE_GENERICO) ");var l="";if(f.length>0){for(var m=0;m<f.length;m++)l=0==m?"MES_ID eq "+f[m]:l+"or MES_ID eq "+f[m];l=" and ("+l+")"}var n="";""!=g&&(n=" and ASPNET_USER_ID eq '"+g+"'");var o="";null!=h&&""!=h&&(o=","+h);var p=b.MSA.BASE+"?$select=ID"+o+"&$filter=ACTIVO eq true "+i+j+k+l+n;return a.get(p)},c.postMSA=function(d){var e=new Date,f=c.getFechaEntero(e),g={LINE_ID:d.tipo,UNID_ENT_ID:d.uAdministracion,UNID_MIN_ID:d.uEntrega,NOMBRE_GENERICO:d.nombre,CODIGO_ISP:d.codigoIsp,FACTOR_CONVERSION:d.factor,MES_ID:d.estado,STOCK_MINIMO:10,STOCK_CRITICO:10,MARCAR_FARMACO_VALIDO:1==d.esValidado?!0:!1,CENTINELA:1==d.esCentinela?!0:!1,CONTROLADO:1==d.esControlado?!0:!1,MONITOREADO:1==d.esMonitoreado?!0:!1,PSICOTROPICO:1==d.esPsicotropico?!0:!1,ES_FARMACIA_POPULAR:1==d.esFarmaciaPopular?!0:!1,ELIMINADO:!1,ACTIVO:!0,FECHA_CREACION:e,FECHA_CREACION_ENTERO:f,ASPNET_USER_ID:d.userId,VISTO_POR:d.userId},h=b.MSA.BASE;return a.post(h,g)},c.putMSA=function(c){var d=b.MSA.BASE;return a.put(d,c)},c.postMHS=function(d){var e=new Date,f=c.getFechaEntero(e),g={MSA_ID:d.msaId,COMENTARIO:d.comentario.substring(0,2e3),ACTIVO:0,ELIMINADO:0,FECHA_CREACION:e,FECHA_CREACION_ENTERO:f,ASPNET_USER_ID:d.userId},h=b.MHS.BASE;return a.post(h,g)},c.activarMHS=function(c){c.ACTIVO=!0;var d=b.MHS.BASE;return a.put(d,c)},c.eliminarMHS=function(c){c.ELIMINADO=!0;var d=b.MHS.BASE;return a.put(d,c)},c.getRECETA=function(c,d,e,f){var g="/10";if(""!=e){g="/"+e;var h="/1";""!=f&&f>1&&(h="/"+f),g+=h}var i=b.RECETA.BASE+"/"+c+"/"+d+g;return a.get(i)},c.countRECETA=function(c,d){var e=b.RECETA.COUNT+"/"+c+"/"+d;return a.get(e)},c.getBODEGA=function(c){var d=b.BODE.BASE+"?$select=*&$filter=NOD_ID eq "+c;return a.get(d)},c.getRL_BODEGA=function(c,d){var e=b.RL_BODEARTI.BASE+"?$select=*&$filter=BODE_ID eq "+c+" and ARTI_ID eq "+d;return a.get(e)},c.putRL_BODEGA=function(c){var d=b.RL_BODEARTI.BASE;return a.put(d,c)},c.getARSENAL=function(c,d,e,f,g,h,i,j){var k="/10";""!=d&&(k="/"+d);var l="/1";""!=e&&e>1&&(l="/"+e);var m="/ID/DESC";""!=f&&(m=""!=g?"/"+f+"/"+g:"/"+f+"/DESC");var n="";""!=h&&(n="/"+h);var o="/2;3";null!=i&&""!=i&&("farmaco"==i?o="/2":"insumo"==i&&(o="/3"));var p="/0";1==j&&(p="/1");var q=b.ARSENAL.BASE+"/"+c+o+p+k+l+m+n;return a.get(q)},c.countARSENAL=function(c,d,e,f){var g="";""!=d&&(g="/"+d);var h="/2;3";null!=e&&""!=e&&("farmaco"==e?h="/2":"insumo"==e&&(h="/3"));var i="/0";1==f&&(i="/1");var j=b.ARSENAL.COUNT+"/"+c+h+i+g;return a.get(j)},c.listaCTDA=function(){var c=b.CTDA.BASE;return a.get(c)},c.getCITA=function(c,d,e,f){var g="/10";null!=e&&""!=e&&(g="/"+e);var h="/1";null!=f&&""!=f&&(h="/"+(f-1));var i=b.CITA.BASE+"/"+c+"/"+d+g+h;return a.get(i)},c.getSGH=function(c,d,e,f){var g="/10";null!=e&&""!=e&&(g="/"+e);var h="/1";null!=f&&""!=f&&(h="/"+(f-1));var i=b.SGH.BASE+"/"+c+"/"+d+g+h;return a.get(i)},c.getFNP=function(c){var d=b.FNP.BASE+"/"+c;return a.get(d,{input:{idFuncionario:c}})},c.getFechaEntero=function(a){var b=a.getFullYear(),c=a.getMonth()+1;1==c.toString().length&&(c="0"+c);var d=a.getDate().toString();d=d.length<2?"0"+d:d;var e=""+b+c+d;return e},c}angular.module("sdx.data").factory("dataService",a),a.$inject=["$http","API"]}(),function(){"use strict";function a(a,b){return b(a.BASE+"/permissions/login/:id",{id:"@IdLogin"},{update:{method:"PUT"}})}function b(a,b,c,d){return{getFacilityPermissionsGroups:function(c){return a.get(b.PERMISSIONS.FACILITY_PROFILES(c)).then(function(a){return a.data})},search:function(c){return a.post(b.PERMISSIONS.SEARCH,{login:c,hcc:d.getCurrentFacility().Name}).then(function(a){return a.data})},getPermissions:function(a){var b=new c;return b.$get({id:a})},savePermissions:function(a){return a.$update()}}}angular.module("sdx.Permissions",[]).factory("PermissionsProfileResource",a).factory("PermissionsService",b),a.$inject=["API","$resource"],
b.$inject=["$http","API","PermissionsProfileResource","loginService"]}();